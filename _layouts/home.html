<!DOCTYPE html>
<html lang="{{ site.lang | default: 'uk' }}">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ site.title }}</title>
  <meta name="description" content="{{ site.description | default: 'Видавництво «Квітка» - класичні історії у вишуканих обкладинках' }}">

  <link href="/assets/css/main.css" rel="stylesheet">

  {% include seo.html %}
</head>
<body class="bg-[#FFF8F0]">
  {% include home/header.html %}

  <main>
    {% include home/book-preorder.html %}
    {% include home/about.html %}
  </main>

  {% include home/footer.html %}

  <script>
    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          const headerOffset = 100; // Adjust based on sticky header height
          const elementPosition = target.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // Active link highlighting based on scroll position
    function highlightActiveSection() {
      const sections = ['book', 'about', 'contact'];
      const scrollPosition = window.scrollY + 150; // Offset for header
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;

      // Check if we're at the bottom of the page
      const isAtBottom = (window.scrollY + windowHeight) >= (documentHeight - 10);

      // First, determine which section is active
      let activeSection = null;

      // Special case: if at bottom, contact is active
      if (isAtBottom) {
        activeSection = 'contact';
      } else {
        // Otherwise, find the section we're currently in
        for (let i = sections.length - 1; i >= 0; i--) {
          const section = document.getElementById(sections[i]);
          if (section && scrollPosition >= section.offsetTop) {
            activeSection = sections[i];
            break;
          }
        }
      }

      // Now update all nav links based on the active section
      sections.forEach(sectionId => {
        const navLink = document.querySelector(`.nav-link[href="#${sectionId}"]`);
        if (navLink) {
          const underline = navLink.querySelector('.nav-underline');
          const isActive = sectionId === activeSection;

          if (isActive) {
            // Active state
            navLink.classList.add('text-[#4B3226]');
            navLink.classList.remove('text-[#31381C]');
            if (underline) {
              underline.classList.add('w-full');
              underline.classList.remove('w-0');
            }
          } else {
            // Inactive state
            navLink.classList.add('text-[#31381C]');
            navLink.classList.remove('text-[#4B3226]');
            if (underline) {
              underline.classList.add('w-0');
              underline.classList.remove('w-full');
            }
          }
        }
      });
    }

    // Add hover effect for underlines
    document.querySelectorAll('.nav-link').forEach(link => {
      const underline = link.querySelector('.nav-underline');

      link.addEventListener('mouseenter', function() {
        if (underline && !link.classList.contains('text-[#4B3226]')) {
          underline.classList.add('w-full');
          underline.classList.remove('w-0');
        }
      });

      link.addEventListener('mouseleave', function() {
        if (underline && !link.classList.contains('text-[#4B3226]')) {
          underline.classList.add('w-0');
          underline.classList.remove('w-full');
        }
      });
    });

    // Listen for scroll events
    window.addEventListener('scroll', highlightActiveSection);

    // Initial highlight check
    highlightActiveSection();
  </script>
</body>
</html>